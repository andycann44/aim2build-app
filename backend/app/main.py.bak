from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware

# Router modules (must exist in backend/app/routers/)
from .routers import sets, inventory, buildability, lego_sync, images

app = FastAPI(title="Aim2Build API", version="0.2.0")

# CORS for local dev (frontend on Vite 5173)
app.add_middleware(
    CORSMiddleware,
    allow_origins=["http://localhost:5173", "http://127.0.0.1:5173"],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

# Register each router exactly once
app.include_router(sets.router,         prefix="/api/v1", tags=["sets"])
app.include_router(inventory.router,    prefix="/api/v1", tags=["inventory"])
app.include_router(buildability.router, prefix="/api/v1", tags=["buildability"])
app.include_router(lego_sync.router,    prefix="/api/v1", tags=["rebrickable"])
app.include_router(images.router,       prefix="/api/v1", tags=["images"])

@app.get("/healthz")
def healthz():
    return {"ok": True, "version": "0.2.0"}
